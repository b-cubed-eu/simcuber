<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gcube">
<title>1. Simulating the occurrence process • gcube</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/PT_Sans-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="1. Simulating the occurrence process">
<meta property="og:description" content="gcube">
<meta property="og:image" content="https://b-cubed-eu.github.io/gcube/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gcube</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/occurrence-process.html">1. Simulating the occurrence process</a>
    <a class="dropdown-item" href="../articles/detection-process.html">2. Simulating the detection process</a>
    <a class="dropdown-item" href="../articles/grid-designation-process.html">3. Specifying the grid designation process</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website">
    <span class="fa fa-cube"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/b-cubed-eu/gcube/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>1. Simulating the occurrence process</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-cubed-eu/gcube/blob/HEAD/vignettes/occurrence-process.Rmd" class="external-link"><code>vignettes/occurrence-process.Rmd</code></a></small>
      <div class="d-none name"><code>occurrence-process.Rmd</code></div>
    </div>

    
    
<p>The workflow for simulating a biodiversity data cube used in gcube
can be divided in three steps or processes:</p>
<ol style="list-style-type: decimal">
<li>Occurrence process</li>
<li>Detection process</li>
<li>Grid designation process</li>
</ol>
<p>This vignette documents the first part of the gcube simulation
workflow, viz. the occurrence process.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/gcube" class="external-link">gcube</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>        <span class="co"># work with spatial objects</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>     <span class="co"># data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>   <span class="co"># data visualisation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span> <span class="co"># visualisation spatraster objects</span></span></code></pre></div>
<div class="section level2">
<h2 id="input">Input<a class="anchor" aria-label="anchor" href="#input"></a>
</h2>
<p>The functions are set up such that a single polygon as input is
enough to go through this workflow using default arguments. The user can
change these arguments to allow for more flexibility. In this vignette
we will demonstrate the different options.</p>
<p>As input, we create a polygon in which we want to simulate
occurrences.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polygon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">1000</span>, <span class="fl">600</span>, <span class="fl">200</span>, <span class="fl">100</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">100</span>, <span class="fl">700</span>, <span class="fl">1000</span>, <span class="fl">900</span>, <span class="fl">500</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The polygon looks like this.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">polygon</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="simulate-occurrences">Simulate occurrences<a class="anchor" aria-label="anchor" href="#simulate-occurrences"></a>
</h2>
<p>We generate occurrence points within the polygon using the
<code><a href="../reference/simulate_occurrences.html">simulate_occurrences()</a></code> function. Default arguments ensure
that an sf object with POLYGON geometry is sufficient to simulate
occurrences.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">simulate_occurrences</span></span></code></pre></div>
<p>The options for user defined arguments are demonstrated in the next
subsections.</p>
<div class="section level3">
<h3 id="changing-number-of-occurrences-over-time">Changing number of occurrences over time<a class="anchor" aria-label="anchor" href="#changing-number-of-occurrences-over-time"></a>
</h3>
<p>Say we want to have 100 occurrences in our plot over 10 years. You
can change the trend in number of occurrences over time. We visualise
this with the helper functions used in
<code><a href="../reference/simulate_occurrences.html">simulate_occurrences()</a></code>. The number of occurrences are
always drawn from a Poisson distribution.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">simulate_timeseries</span></span></code></pre></div>
<p><strong>Option 1</strong></p>
<p>If we do not specify a temporal function, we draw from a Poisson
distribution for each time point with average (lambda parameter)
<code>initial_average_occurrences</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_occurrences_indep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_timeseries.html">simulate_timeseries</a></span><span class="op">(</span></span>
<span>  initial_average_occurrences <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_time_points <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  temporal_function <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span></code></pre></div>
<p>We plot the simulated number of occurrences over time. We see that
the average is close to 100 over time as expected. Using a different
seed will result in different numbers but the average will be (close to)
100 over time.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  n_occurrences <span class="op">=</span> <span class="va">n_occurrences_indep</span>,</span>
<span>  time_point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">n_occurrences_indep</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_point</span>, y <span class="op">=</span> <span class="va">n_occurrences</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p><strong>Option 2</strong></p>
<p>We can specify a function ourselves, e.g. the internal function
<code><a href="../reference/simulate_random_walk.html">simulate_random_walk()</a></code> to have a random walk over time. A
random walk is a mathematical concept where each step is determined
randomly. The <code>sd_step</code> parameter refers to the standard
deviation of these random steps (drawn from a Normal distribution). A
higher value leading to larger steps and potentially greater variability
in the path of the random walk.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_occurrences_walk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_timeseries.html">simulate_timeseries</a></span><span class="op">(</span></span>
<span>  initial_average_occurrences <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_time_points <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  temporal_function <span class="op">=</span> <span class="va">simulate_random_walk</span>,</span>
<span>  sd_step <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span></code></pre></div>
<p>We plot the simulated number of occurrences over time which follow a
random walk. Using a different seed will result in a different random
pattern.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  n_occurrences <span class="op">=</span> <span class="va">n_occurrences_walk</span>,</span>
<span>  time_point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">n_occurrences_walk</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_point</span>, y <span class="op">=</span> <span class="va">n_occurrences</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p><strong>Option 3</strong></p>
<p>We can specify a function ourselves that determines the average trend
in number of occurrences over time. Here we provide an example for a
linear trend.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_own_linear_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">initial_average_occurrences</span> <span class="op">=</span> <span class="va">initial_average_occurrences</span>,</span>
<span>    <span class="va">n_time_points</span> <span class="op">=</span> <span class="va">n_time_points</span>,</span>
<span>    <span class="va">coef</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Calculate new average abundances over time</span></span>
<span>  <span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_time_points</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="va">initial_average_occurrences</span> <span class="op">+</span> <span class="op">(</span><span class="va">coef</span> <span class="op">*</span> <span class="va">time</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Identify where the lambda values become 0 or lower</span></span>
<span>  <span class="va">zero_or_lower_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">lambdas</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># If any lambda becomes 0 or lower, set all subsequent lambdas to 0</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">zero_or_lower_index</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">zero_or_lower_indices</span> <span class="op">&lt;-</span> <span class="va">zero_or_lower_index</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">:</span><span class="va">n_time_points</span></span>
<span>    <span class="va">lambdas</span><span class="op">[</span><span class="va">zero_or_lower_indices</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Return average abundances</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">lambdas</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We try out a linear trend with slope equal to 1.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_occurrences_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_timeseries.html">simulate_timeseries</a></span><span class="op">(</span></span>
<span>  initial_average_occurrences <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_time_points <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  temporal_function <span class="op">=</span> <span class="va">my_own_linear_function</span>,</span>
<span>  coef <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span></code></pre></div>
<p>We plot the simulated number of occurrences over time. We see that
the average slope is indeed close to 1. Using a different seed will
result in different numbers but the average slope will be (close to)
1.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  n_occurrences <span class="op">=</span> <span class="va">n_occurrences_linear</span>,</span>
<span>  time_point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">n_occurrences_linear</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_point</span>, y <span class="op">=</span> <span class="va">n_occurrences</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="changing-the-degree-of-spatial-clustering">Changing the degree of spatial clustering<a class="anchor" aria-label="anchor" href="#changing-the-degree-of-spatial-clustering"></a>
</h3>
<p>We can also choose the amount of spatial clustering. We visualise
this with the helper functions used in
<code><a href="../reference/simulate_occurrences.html">simulate_occurrences()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">create_spatial_pattern</span></span></code></pre></div>
<p><strong>Option 1</strong></p>
<p>There are defaults for random and clustered patterns. Let’s look at
the default where we have no clustering.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rs_pattern_random</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_spatial_pattern.html">create_spatial_pattern</a></span><span class="op">(</span></span>
<span>  polygon <span class="op">=</span> <span class="va">polygon</span>,</span>
<span>  resolution <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  spatial_pattern <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span><span class="co">#&gt; [using unconditional Gaussian simulation]</span></span></code></pre></div>
<p>We see values of high sampling probability randomly distributed.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rs_pattern_random</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p><strong>Option 2</strong></p>
<p>Let’s look at the default where we have clustering (same as
<code>spatial_pattern = 10</code>, see further).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rs_pattern_clustered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_spatial_pattern.html">create_spatial_pattern</a></span><span class="op">(</span></span>
<span>  polygon <span class="op">=</span> <span class="va">polygon</span>,</span>
<span>  resolution <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  spatial_pattern <span class="op">=</span> <span class="st">"clustered"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span><span class="co">#&gt; [using unconditional Gaussian simulation]</span></span></code></pre></div>
<p>We see values of high sampling probability clustered together.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rs_pattern_clustered</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p><strong>Option 3</strong></p>
<p>We can also change the clustering ourselves. A larger number for
<code>spatial_pattern</code> means a broader size of the clusters area.
Let’s look at a low value for clustering.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rs_pattern_clustered2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_spatial_pattern.html">create_spatial_pattern</a></span><span class="op">(</span></span>
<span>  polygon <span class="op">=</span> <span class="va">polygon</span>,</span>
<span>  resolution <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  spatial_pattern <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span><span class="co">#&gt; [using unconditional Gaussian simulation]</span></span></code></pre></div>
<p>We see values of high sampling probability in multiple, smaller
clusters.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rs_pattern_clustered2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>Let’s look at a high value for clustering.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rs_pattern_clustered3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_spatial_pattern.html">create_spatial_pattern</a></span><span class="op">(</span></span>
<span>  polygon <span class="op">=</span> <span class="va">polygon</span>,</span>
<span>  resolution <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  spatial_pattern <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span><span class="co">#&gt; [using unconditional Gaussian simulation]</span></span></code></pre></div>
<p>We see values of high sampling probability in fewer, larger
clusters.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rs_pattern_clustered3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>The patterns generated above are then used for sampling using a
different helper function.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">sample_occurrences_from_raster</span></span></code></pre></div>
<p>If we for example sample 500 occurrences from the last raster, we see
the sampling is according to the expected pattern.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pts_occ_clustered3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_occurrences_from_raster.html">sample_occurrences_from_raster</a></span><span class="op">(</span></span>
<span>  rs <span class="op">=</span> <span class="va">rs_pattern_clustered3</span>,</span>
<span>  ts <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rs_pattern_clustered3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pts_occ_clustered3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Now that we know how the helper functions work, we can generate
occurrence points within the polygon using the
<code><a href="../reference/simulate_occurrences.html">simulate_occurrences()</a></code> function. We can for example sample
randomly within the polygon over 6 time points were we use a random walk
over time with an initial average number of occurrences equal to
100.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">occurrences_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_occurrences.html">simulate_occurrences</a></span><span class="op">(</span></span>
<span>  plgn <span class="op">=</span> <span class="va">polygon</span>,</span>
<span>  initial_average_abundance <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_time_points <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  temporal_function <span class="op">=</span> <span class="va">simulate_random_walk</span>,</span>
<span>  sd_step <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  spatial_autocorr <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span><span class="co">#&gt; [using unconditional Gaussian simulation]</span></span></code></pre></div>
<p>This is the number of occurrences we have for each time point.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">occurrences_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">time_point</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span>  <span class="va">time_point</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<p>This is the spatial distribution of the occurrences for each time
point.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">polygon</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">occurrences_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">time_point</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Distribution of occurrences for each time point"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="occurrence-process_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ward Langeraert, European Union’s Horizon Europe Research and Innovation Programme (ID No 101059592).</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
